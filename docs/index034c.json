{"id":613,"date":"2014-03-31T10:38:29","date_gmt":"2014-03-31T01:38:29","guid":{"rendered":"http:\/\/blog.susumuis.info\/?p=613"},"modified":"2014-07-01T19:35:53","modified_gmt":"2014-07-01T10:35:53","slug":"sun-misc-unsafe%e3%82%92%e4%bd%bf%e3%81%86","status":"publish","type":"post","link":"https:\/\/www.susumuis.info\/entry\/2014\/03\/31\/103829","title":{"rendered":"sun.misc.Unsafe\u3092\u4f7f\u3046"},"content":{"rendered":"<p>\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u547c\u3070\u306a\u3044\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\u30ea\u30d5\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u6a2a\u304b\u3089\u5f37\u5236\u7684\u306b\u521d\u671f\u5316\u3068\u3044\u3046\u884c\u70ba\u304c\u5fc5\u8981\u3060\u3063\u305f\u3002sun.misc.Unsafe\u3068\u3044\u3046API\u3092\u4f7f\u7528\u3059\u308b\u3068\u3067\u304d\u308b\u3089\u3057\u3044\u306e\u3067\u3084\u3063\u3066\u307f\u305f\u3002\u3042\u3063\u3051\u306a\u304f\u51fa\u6765\u3066\u3057\u307e\u3063\u305f\u3002\u307e\u305a\u306f\u4eca\u56de\u30c6\u30b9\u30c8\u3057\u305f\u30b3\u30fc\u30c9\u3092\u4e0b\u8a18\u306b\u8cbc\u308a\u4ed8\u3051\u307e\u3059\u3002<\/p>\n\n<pre><code class=\"language-java\">import java.lang.reflect.Field;\nimport sun.misc.Unsafe;\n\npublic class UnsafeTest {\n    public UnsafeTest() {\n        throw new RuntimeException(\"can't instantiate this class\");\n    }\n\n    private String name = \"\";\n\n    public void hello() {\n        System.out.println(\"hello, \" + name);\n    }\n\n    public static void main(String[] args) {\n        Unsafe unsafe = getUnsafe();\n        try {\n            while (true) {\n                UnsafeTest instance = (UnsafeTest) unsafe.allocateInstance(UnsafeTest.class);\n                instance.name = \"hoge\";\n                instance.hello();\n            }\n        } catch (InstantiationException e) {\n            e.printStackTrace();\n        }\n    }\n\n    private static Unsafe getUnsafe() {\n        try {\n            Field singleoneInstanceField = Unsafe.class.getDeclaredField(\"theUnsafe\");\n            singleoneInstanceField.setAccessible(true);\n            return (Unsafe) singleoneInstanceField.get(null);\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n<\/code><\/pre>\n\n<p>\u00a0<\/p>\n\n<p>\u5b9f\u884c\u3059\u308b\u3068\u5ef6\u3005\u3068\u3001\"hello, hoge\"\u3068\u51fa\u529b\u3055\u308c\u307e\u3059\u3002<\/p>\n\n<p>\u3053\u306e\u30af\u30e9\u30b9\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u547c\u3076\u3068\u4f8b\u5916\u3092\u98db\u3070\u3059\u9177\u3044\u3084\u3064\u3067\u3059\u304c\u3001\u3061\u3083\u3093\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002<\/p>\n\n<p>\u00a0<\/p>\n\n<p>\u30b3\u30fc\u30c9Unsafe\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u53d6\u5f97\u304c\u30ea\u30d5\u30ec\u30af\u30b7\u30e7\u30f3\u7d4c\u7531\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3069\u3046\u3084\u3089\u3001\u3053\u306e\u53d6\u308a\u65b9\u304c\u81ea\u5206\u304c\u8abf\u3079\u305f\u9650\u308a\u4e3b\u6d41\u306e\u3088\u3046\u3067\u3059\u3002<\/p>\n\n<p>\u7406\u7531\u306f<\/p>\n\n<ul>\n<li>Unsafe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306fprivate\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306a\u306e\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3067\u304d\u306a\u3044<\/li>\n<li>Unsafe.getUnsafe()\u30e1\u30bd\u30c3\u30c9\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5236\u5fa1\u3055\u308c\u3066\u3044\u3066\u3001trusted\u306a\u30af\u30e9\u30b9\u304b\u3089\u3057\u304b\u4f7f\u7528\u3067\u304d\u306a\u3044<\/li>\n<li>\u3051\u3069\u3001\u305d\u3044\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fUnsafe\u30af\u30e9\u30b9\u306estatic\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 theUnsafe \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3001\u30ea\u30d5\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u300c\u76d7\u3080\u300d\u3053\u3068\u304c\u3067\u304d\u308b<\/li>\n<\/ul>\n\n<p>\u3068\u3044\u3046\u3053\u3068\u307f\u305f\u3044\u3067\u3059\u3002<\/p>\n\n<p>\u8a73\u3057\u304f\u306f\u00a0<a href=\"http:\/\/mishadoff.github.io\/blog\/java-magic-part-4-sun-dot-misc-dot-unsafe\/\">http:\/\/mishadoff.github.io\/blog\/java-magic-part-4-sun-dot-misc-dot-unsafe\/<\/a><\/p>\n\n<p>\u00a0<\/p>\n\n<p>\u7121\u9650\u30eb\u30fc\u30d7\u306b\u3057\u305f\u306e\u306f\u3001Unsafe\u3068\u3044\u3046\u540d\u524d\u306b\u30d3\u30d3\u3063\u305f\u306e\u3067\u3001\u307e\u3055\u304b\u30e1\u30e2\u30ea\u7ba1\u7406\u3055\u308c\u306a\u3044\u3068\u304b\u306a\u3044\u304b\u3001\u8abf\u3079\u308b\u305f\u3081\u3067\u3059\u3002<\/p>\n\n<p>\u5b9f\u884c\u3055\u305b\u305f\u307e\u307e\u3001jvisualvm\u3067\u3067\u30d2\u30fc\u30d7\u60c5\u5831\u3092\u898b\u305f\u3068\u3053\u308d\u53f3\u80a9\u4e0a\u304c\u308a\u306b\u306f\u306a\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002<\/p>\n\n<p>\u7d50\u679c\u306f\u6b21\u306e\u901a\u308a<\/p>\n\n<p>\u306a\u304a\u3001\u3053\u306e\u7d50\u679c\u306f\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u3082\u306e\u3067\u3059\u306e\u3067\u3001\u4ed6\u306e\u65b9\u306e\u74b0\u5883\u3067\u306f\u540c\u3058\u7d50\u679c\u306b\u306a\u308b\u3068\u306f\u9650\u308a\u307e\u305b\u3093\u306e\u3067\u3054\u4e86\u627f\u4e0b\u3055\u3044\u3002<\/p>\n\n<p>\u00a0<\/p>\n\n<p>Java7<\/p>\n\n<p><span><img decoding=\"async\" class=\"hatena-fotolife\" title=\"f:id:s-ishigami:20140331102547p:plain\" src=\"http:\/\/cdn-ak.f.st-hatena.com\/images\/fotolife\/s\/s-ishigami\/20140331\/20140331102547.png\" alt=\"f:id:s-ishigami:20140331102547p:plain\" \/><\/span><\/p>\n\n<p>\u00a0<\/p>\n\n<p><span style=\"line-height: 1.5;\">Java8<\/span><\/p>\n\n<p><img decoding=\"async\" class=\"hatena-fotolife\" title=\"f:id:s-ishigami:20140331103427p:plain\" src=\"http:\/\/cdn-ak.f.st-hatena.com\/images\/fotolife\/s\/s-ishigami\/20140331\/20140331103427.png\" alt=\"f:id:s-ishigami:20140331103427p:plain\" \/><\/p>\n\n<p>Java5<\/p>\n\n<p><img decoding=\"async\" class=\"hatena-fotolife\" title=\"f:id:s-ishigami:20140331100738p:plain\" src=\"http:\/\/cdn-ak.f.st-hatena.com\/images\/fotolife\/s\/s-ishigami\/20140331\/20140331100738.png\" alt=\"f:id:s-ishigami:20140331100738p:plain\" \/><\/p>\n\n<p>\u5ff5\u306e\u70ba\u306b\u3001heap dump\u3082\u53d6\u3063\u3066\u3044\u307e\u3057\u305f\u304cUnsafeTest\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u306f0\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u306e\u3067\u3001\u78ba\u304b\u306bGC\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002<\/p>\n\n<p>\u00a0<\/p>\n\n<p>\u00a0<\/p>\n<p style=\"margin-top: 0px; margin-bottom: 32px;>\n<script async src=\"\/\/pagead2.googlesyndication.com\/pagead\/js\/adsbygoogle.js\"><\/script>\n<ins class=\"adsbygoogle\"\n     style=\"display:inline-block;width:336px;height:280px\"\n     data-ad-client=\"ca-pub-4600091038664361\"\n     data-ad-slot=\"6658249733\"><\/ins>\n<script>\n(adsbygoogle = window.adsbygoogle || []).push({});\n<\/script>\n<\/p>","protected":false},"excerpt":{"rendered":"<p>\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u547c\u3070\u306a\u3044\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\u30ea\u30d5\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u6a2a\u304b\u3089\u5f37\u5236\u7684\u306b\u521d\u671f\u5316\u3068\u3044\u3046\u884c\u70ba\u304c\u5fc5\u8981\u3060\u3063\u305f\u3002sun.misc.Unsafe\u3068\u3044\u3046API\u3092\u4f7f\u7528\u3059\u308b\u3068\u3067\u304d\u308b\u3089\u3057\u3044\u306e\u3067\u3084\u3063\u3066\u307f\u305f\u3002\u3042\u3063\u3051\u306a\u304f\u51fa\u6765\u3066\u3057\u307e\u3063\u305f\u3002\u307e\u305a [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[42],"tags":[],"_links":{"self":[{"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/posts\/613"}],"collection":[{"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=%2Fwp%2Fv2%2Fcomments&post=613"}],"version-history":[{"count":3,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/posts\/613\/revisions"}],"predecessor-version":[{"id":984,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=\/wp\/v2\/posts\/613\/revisions\/984"}],"wp:attachment":[{"href":"https:\/\/www.susumuis.info\/index.php?rest_route=%2Fwp%2Fv2%2Fmedia&parent=613"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=%2Fwp%2Fv2%2Fcategories&post=613"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.susumuis.info\/index.php?rest_route=%2Fwp%2Fv2%2Ftags&post=613"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}